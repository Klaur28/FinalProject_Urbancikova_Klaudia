<!DOCTYPE html>
<html lang="sk" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6" class="h-100">
<head th:replace="~{fragments/layout.html :: head}">
    <title>Detail poistnej zmluvy</title>
</head>
<body class="d-flex flex-column h-100 bg-light">
<header th:replace="~{fragments/layout.html :: header}"></header>

<div class="container py-5 flex-grow-1">
    <main role="main">
        <!-- Navigačná lišta (breadcrumb) -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}">Domov</a></li>
                <li class="breadcrumb-item"><a th:href="@{/poistenci}">Poistenci</a></li>
                <li class="breadcrumb-item active" aria-current="page">Detail poistnej zmluvy</li>
            </ol>
        </nav>
        <h3 class="page-title">Detail poistnej zmluvy</h3>
        <div class="page-title-line mb-4"></div>
        <div class="text-center text-muted mb-4">
            <p>Informácie o poistnej zmluve.</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-primary bg-opacity-50 text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0" th:text="'Zmluva č. ' + ${poistenie.cisloZmluvy}">Detail poistnej zmluvy</h5>
                        <div>
                            <a th:href="@{/poistnezmluvy/{id}/oprav(id=${poistenie.id})}" class="btn btn-light btn-sm">
                                <i class="fas fa-edit me-1"></i> Upraviť
                            </a>
                            <button type="button" class="btn btn-outline-light btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                <i class="fas fa-trash me-1"></i> Vymazať
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <!-- Zobrazenie chybovej správy, ak existuje -->
                        <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>

                        <div class="row g-4 mb-4">
                            <!-- Základné údaje -->
                            <div class="col-md-6">
                                <h5 class="mb-3 border-bottom pb-2">Základné údaje</h5>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">ID:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <span class="badge bg-light text-dark" th:text="${poistenie.id}"></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Číslo zmluvy:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-file-contract me-1 text-primary opacity-50 small"></i>
                                            <span th:text="${poistenie.cisloZmluvy}"></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Druh poistenia:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                      <span th:switch="${poistenie.druhPoistenia}" class="badge rounded-pill"
                            th:classappend="${
                              poistenie.druhPoistenia == 'Auto' ? 'bg-primary bg-opacity-50' :
                              poistenie.druhPoistenia == 'Nehnuteľnosť' ? 'bg-success bg-opacity-50' :
                              poistenie.druhPoistenia == 'Cestovné' ? 'bg-info bg-opacity-50' :
                              poistenie.druhPoistenia == 'Zdravotné' ? 'bg-warning bg-opacity-50' :
                              poistenie.druhPoistenia == 'Životné' ? 'bg-danger bg-opacity-50' : 'bg-secondary bg-opacity-50'
                            }">
                        <i th:switch="${poistenie.druhPoistenia}" class="fas me-1"
                           th:classappend="${
                             poistenie.druhPoistenia == 'Auto' ? 'fa-car' :
                             poistenie.druhPoistenia == 'Nehnuteľnosť' ? 'fa-home' :
                             poistenie.druhPoistenia == 'Cestovné' ? 'fa-plane' :
                             poistenie.druhPoistenia == 'Zdravotné' ? 'fa-heartbeat' :
                             poistenie.druhPoistenia == 'Životné' ? 'fa-user-shield' : 'fa-shield-alt'
                           }"></i>
                        <span th:text="${poistenie.druhPoistenia}"></span>
                      </span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Suma (€):</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-euro-sign me-1 text-primary opacity-50 small"></i>
                                            <span class="fw-medium" th:text="${#numbers.formatDecimal(poistenie.suma, 0, 'POINT', 2, 'COMMA')}"></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Vzťah k poisteniu:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-exchange-alt me-1 text-primary opacity-50 small"></i>
                                            <span class="badge"
                                                  th:classappend="${
                              poistenie.relation.name() == 'PAYER' ? 'bg-primary bg-opacity-50' :
                              poistenie.relation.name() == 'COVERED' ? 'bg-success bg-opacity-50' : 'bg-warning bg-opacity-50'
                            }"
                                                  th:text="${poistenie.relation.label}">
                      </span>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Platnosť a vzťahy -->
                            <div class="col-md-6">
                                <h5 class="mb-3 border-bottom pb-2">Platnosť a vzťahy</h5>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Platnosť od:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-calendar-alt me-1 text-primary opacity-50 small"></i>
                                            <span th:text="${#temporals.format(poistenie.platnostOd, 'dd.MM.yyyy')}"></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Platnosť do:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-calendar-alt me-1 text-primary opacity-50 small"></i>
                                            <span th:text="${#temporals.format(poistenie.platnostDo, 'dd.MM.yyyy')}"></span>
                                            <span th:if="${#temporals.createToday() gt poistenie.platnostDo}"
                                                  class="badge bg-danger bg-opacity-50 ms-1" title="Platnosť vypršala">
                        <i class="fas fa-exclamation-circle"></i> Exspirovaná
                      </span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Poistenec:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-user me-1 text-primary opacity-50 small"></i>
                                            <a th:href="@{/poistenci/{id}(id=${poistenie.poistenecId})}" class="text-decoration-none" th:text="${poistenie.poistenecMeno}"></a>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Stav platnosti:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-check-circle me-1 text-primary opacity-50 small" th:if="${#temporals.createToday() le poistenie.platnostDo}"></i>
                                            <i class="fas fa-times-circle me-1 text-danger opacity-50 small" th:if="${#temporals.createToday() gt poistenie.platnostDo}"></i>
                                            <span class="badge"
                                                  th:classappend="${#temporals.createToday() le poistenie.platnostDo ? 'bg-success bg-opacity-50' : 'bg-danger bg-opacity-50'}">
                        <span th:text="${#temporals.createToday() le poistenie.platnostDo ? 'Platná' : 'Neplatná'}"></span>
                      </span>
                                        </p>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label class="col-sm-4 col-form-label text-muted">Vytvorená:</label>
                                    <div class="col-sm-8">
                                        <p class="form-control-plaintext">
                                            <i class="fas fa-calendar-plus me-1 text-primary opacity-50 small"></i>
                                            <span th:if="${poistenie.createdAt != null}" th:text="${#temporals.format(poistenie.createdAt, 'dd.MM.yyyy')}">01.01.2025</span>
                                            <span th:if="${poistenie.createdAt == null}">—</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Informácie o platnosti -->
                        <h5 class="mb-3 border-bottom pb-2">Informácie o platnosti</h5>
                        <div class="mb-4 p-3 bg-light rounded border"
                             th:with="daysLeft=${(poistenie.platnostDo.toEpochDay() - #temporals.createToday().toEpochDay())}">
                            <div class="row">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <div class="d-flex">
                                        <div class="me-3 text-primary">
                                            <i class="fas fa-info-circle fa-2x opacity-50"></i>
                                        </div>
                                        <div>
                                            <p class="mb-2" th:if="${daysLeft > 0}">
                                                Táto poistná zmluva je platná ešte <strong th:text="${daysLeft}">0</strong> dní.
                                            </p>
                                            <p class="mb-2" th:if="${daysLeft <= 0}">
                                                Táto poistná zmluva už <strong th:text="${daysLeft * -1}">0</strong> dní nie je platná.
                                            </p>

                                            <div class="progress mt-3" style="height: 8px;" th:if="${daysLeft > 0}">
                                                <div class="progress-bar bg-primary bg-opacity-50" role="progressbar"
                                                     th:style="'width: ' + ${#numbers.formatDecimal((daysLeft/365.0)*100, 0, 2)} + '%'"
                                                     aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <div class="small text-muted mt-1" th:if="${daysLeft > 0}">
                                                <span th:text="${#numbers.formatDecimal((daysLeft/365.0)*100, 0, 2)}">0</span>% času do exspirácie
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6" th:if="${daysLeft > 0 && daysLeft < 30}">
                                    <div class="d-flex">
                                        <div class="me-3 text-warning">
                                            <i class="fas fa-exclamation-triangle fa-2x opacity-50"></i>
                                        </div>
                                        <div>
                                            <p class="mb-1 fw-bold">Upozornenie na blížiacu sa exspiráciu</p>
                                            <p class="mb-2 small text-muted">
                                                Táto zmluva čoskoro vyprší. Odporúčame kontaktovať klienta kvôli predĺženiu.
                                            </p>
                                            <a href="#" class="btn btn-sm btn-outline-warning">
                                                <i class="fas fa-envelope me-1"></i> Poslať upozornenie
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tlačidlá akcií -->
                        <div class="d-flex justify-content-between">
                            <a th:href="@{/poistnezmluvy}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Späť na zoznam
                            </a>
                            <div>
                                <a th:href="@{/poistnezmluvy/{id}/oprav(id=${poistenie.id})}" class="btn btn-primary me-2">
                                    <i class="fas fa-edit me-1"></i> Upraviť
                                </a>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="fas fa-file-pdf me-1"></i> Dokumenty
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="#"><i class="fas fa-file-pdf me-2 text-danger"></i> Tlačiť zmluvu</a></li>
                                        <li><a class="dropdown-item" href="#"><i class="fas fa-file-invoice me-2 text-primary"></i> Generovať faktúru</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" href="#"><i class="fas fa-envelope me-2 text-success"></i> Odoslať dokumenty</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pre potvrdenie vymazania -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content border-0 shadow">
                    <div class="modal-header bg-danger bg-opacity-50 text-white">
                        <h5 class="modal-title" id="deleteModalLabel">Potvrdiť vymazanie</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-4">
                        <p class="mb-4">
                            Naozaj chcete vymazať poistnú zmluvu <strong th:text="${poistenie.cisloZmluvy}"></strong>?
                        </p>
                        <div class="alert alert-danger bg-danger bg-opacity-10 border-danger">
                            <div class="d-flex">
                                <div class="me-2">
                                    <i class="fas fa-exclamation-triangle text-danger"></i>
                                </div>
                                <div>
                                    <strong>Upozornenie:</strong> Táto akcia je nezvratná!
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Zrušiť</button>
                        <form th:action="@{/poistnezmluvy/{id}/vymaz(id=${poistenie.id})}" method="post">
                            <input type="hidden" name="_csrf" th:value="${_csrf.token}" />
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash me-1"></i> Vymazať
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<footer th:replace="~{fragments/layout.html :: footer}"></footer>
</body>
</html>